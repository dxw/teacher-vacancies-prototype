<div id="map"></div>

<script>
    var vacancies = []
    {% for vacancy in vacancies %}
    vacancies.push({
      school_name: '{{ json.schools[vacancy.school_id].name }}',
      job_title: '{{ vacancy.title }}',
      link: '{{ vacancy.slug | url('vacancies') }}',
      lng: {{ json.schools[vacancy.school_id].lng }},
      lat: {{ json.schools[vacancy.school_id].lat }},
    })
    {% endfor %}

  function initMap() {
    var bounds = new google.maps.LatLngBounds();
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 8
    });
    var infos = [];
    var markers = [];
    var infoWindow = new google.maps.InfoWindow();
    for (var x in vacancies) {
      var vacancy = vacancies[x]
      infos[x] = '<h3><a href="'+vacancy.link+'">'+vacancy.job_title+'</a></h3><p><strong>'+vacancy.school_name+'</strong></p>';
      markers[x] = new google.maps.Marker({
        position: {lat: vacancy.lat, lng: vacancy.lng},
        map: map,
        title: vacancy.job_title
      });
      bounds.extend(markers[x].position);
      google.maps.event.addListener(markers[x], 'click', (function(marker, x) {
        return function() {
          infoWindow.setContent(infos[x]);
          infoWindow.open(map, marker);
        }
      })(markers[x], x));
    }
    map.fitBounds(bounds);
  }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap">
</script>
